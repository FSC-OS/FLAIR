<!DOCTYPE html>
<html class="ui-mobile-rendering">
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;"">
    <link rel="stylesheet" href="css/jquery.mobile-1.1.1.min.css"/>


    <!-- Templates -->

    <!-- Home Page -->
    <script type="text/template" id="home">

        <div data-role="header">
            <h1>FLAIR</h1>
            <a href="#visualisation" data-icon="gear" class="ui-btn-right">Visualisation</a>
        </div>

        <div data-role="content">
            <p>This is the homepage</p>
            <ul id="sites" data-role="listview">
                <% _.each(sites, function(site) { %>
                    <li><a href="#site/<%= site.id %>"><%= site.location.name %></a></li>
                <% }); %>
            </ul>
        </div>

    </script>

    <!-- Visualisation Page -->
    <script type="text/template" id="visualisation">

        <div data-role="header">
            <a href="#" data-icon="back" class="ui-btn-left">Home</a>
            <h1>Visualisation</h1>
        </div>

        <div data-role="content">
            <p>This is the visualisation page</p>
        </div>

    </script>

    <!-- Site Page -->
    <script type="text/template" id="site">

        <div data-role="header">
            <a href="#" data-icon="back" class="ui-btn-left">Home</a>
            <h1><%= site.location.name %></h1>
        </div>

        <div data-role="content" id="site<%= site.id %>-content">
            <h2><%= site.location.name %></h2>
            <% if(complete) { %>
                <p>You need to complete the following experiments at this site:</p>
            <% } else { %>
                <p>You have completed this site.</p>
            <% } %>
            <ul id="experiments" data-role="listview">
                <% _.each(site.experiments, function(experiment) { %>
                    <li>
                        <a href="#site/<%= site.id %>/experiment/<%= experiment.id %>">
                            <%= experiment.experimentType %>
                        </a>
                    </li>
                <% }); %>
            </ul>
        </div>

    </script>

    <!-- Experiment Page -->
    <script type="text/template" id="experiment">

        <div data-role="header">
            <a href="<%= previous %>" data-icon="back" class="ui-btn-left">
                <%= experiment.site.location.name %>
            </a>
            <h1><%= experiment.experimentType %></h1>
        </div>

        <div data-role="content" id="<%= pageId %>-content">
            <h3><%= experiment.experimentType %></h3>
            <p><%= experiment.help %></p>
            <div class="form">
                <!-- The View JS will put the form here -->
            </div>
            <a href="<%= next %>" data-role="button" class="next">Next</a>
        </div>

    </script>

    <!-- Scripts -->
    <!-- Libs -->
    <script src="lib/jquery-1.7.2.min.js"></script>
    <script src="app/jqm-config.js"></script>
    <script src="lib/jquery.mobile-1.1.1.min.js"></script>
    <script src="lib/underscore-min.js"></script>
    <script src="lib/backbone-min.js"></script>
    <script src="lib/backbone-relational.js"></script>
    <script src="lib/backbone.localStorage-min.js"></script>
    <script src="lib/backbone-forms.min.js"></script>
    <script src="app/templates/backbone-forms-jquery-mobile-templates.js"></script>

    <!-- App -->
    <!-- Models & Collections-->
    <script src="app/models/experiment.js"></script>
    <script src="app/collections/experiment.js"></script>
    <script src="app/models/site.js"></script>
    <script src="app/collections/exercise.js"></script>

    <!-- Views -->
    <script src="app/views/home.js"></script>
    <script src="app/views/visualisation.js"></script>
    <script src="app/views/site.js"></script>
    <script src="app/views/experiment.js"></script>

    <!-- Router -->
    <script src="app/router/router.js"></script>

    <!-- Bootstrap -->
    <script type="text/javascript">
        // Bootstrapped Collection of sites, eventually this will be loaded
        // from somewhere else

        // Create the Exercise
        window.Sites = new Exercise();

        // Populate it with some data - this is just "in-memory" until
        // we save it to the persistence
        Sites.reset(
            [{
                id:1,
                location: {
                    name:"Site1"        
                },
                experiments: new ExperimentCollection(
                    [{
                        id:1,
                        userId: "Group1",
                        groupId: "Group1",
                        datetime: "2012-01-01",
                        experimentType: "Wet Width",
                        help: "The Wet Width is the width of the water at the water line",
                        notes: "",
                        data: {
                            measurement:1.9,
                            unitOfMeasurement:"m"
                        },
                        schema: {
                            measurement: {
                                title: "Wet Width (m)",
                                type: 'Number',
                                validators: 'required',
                            }
                        }
                    },
                    {
                        id:2,
                        userId: "Group1",
                        groupId: "Group1",
                        datetime: "2012-01-01",
                        experimentType: "Wetted Perimeter",
                        notes: "",
                        help: "The wetted perimeter is the distance across the bed of the river, plus it's width across the surface",
                        data: {
                            measurement:2.38,
                            unitOfMeasurement:"m"     
                        },
                        schema: {
                            measurement: {
                                title: "Wetted Perimeter (m)",
                                type: 'Number',
                                validators: 'required'
                            }
                        }
                    },
                    {
                        id:3,
                        userId: "Group1",
                        groupId: "Group1",
                        datetime: "2012-01-01",
                        experimentType: "Gradient",
                        notes: "",
                        help: "Use your clinometer to measure the gradient of the surface of the water",
                        data: {
                            measurement:4,
                            unitOfMeasurement:"degree"        
                        },
                        schema: {
                            measurement: {
                                title: "Gradient (degree)",
                                type: 'Number',
                                validators: 'required'
                            }
                        }
                    },
                    {
                        id:4,
                        userId: "Group1",
                        groupId: "Group1",
                        datetime: "2012-01-01",
                        experimentType: "Wet (Water) Depth",
                        notes: "",
                        help: "Next we need to measure the depth of the water at 5 points across it. Make sure you evenly space you measurements.",
                        data: {
                            measurement1:0.2,
                            measurement2:0.25,
                            measurement3:0.11,
                            measurement4:0.1,
                            measurement5:0.1,
                            unitOfMeasurement:"m" 
                        },
                        schema: {
                            measurement1: {
                                title: "Wet (Water) Depth 1",
                                type: 'Number',
                                validators: 'required'
                            },
                            measurement2: {
                                title: "Wet (Water) Depth 2",
                                type: 'Number',
                                validators: 'required'
                            },
                            measurement3: {
                                title: "Wet (Water) Depth 3",
                                type: 'Number',
                                validators: 'required'
                            },
                            measurement4: {
                                title: "Wet (Water) Depth 4",
                                type: 'Number',
                                validators: 'required'
                            },
                            measurement5: {
                                title: "Wet (Water) Depth 5",
                                type: 'Number',
                                validators: 'required'
                            }
                        }
                    },
                    {
                        id:5,
                        userId: "Group1",
                        groupId: "Group1",
                        datetime: "2012-01-01",
                        experimentType: "Impellor Time",
                        notes: "",
                        help: "Measure how long it takes the impellor to go from one end to the other at 5 different points across the river. Again, make sure you measure at even points.",
                        data: {
                            measurement1:75,
                            measurement2:28,
                            measurement3:20,
                            measurement4:19.5,
                            measurement5:78,
                            unitOfMeasurement:"seconds"   
                        },
                        schema: {
                            measurement1: {
                                title: "Impellor Time 1",
                                type: 'Number',
                                validators: 'required'
                            },
                            measurement2: {
                                title: "Impellor Time 2",
                                type: 'Number',
                                validators: 'required'
                            },
                            measurement3: {
                                title: "Impellor Time 3",
                                type: 'Number',
                                validators: 'required'
                            },
                            measurement4: {
                                title: "Impellor Time 4",
                                type: 'Number',
                                validators: 'required'
                            },
                            measurement5: {
                                title: "Impellor Time 5",
                                type: 'Number',
                                validators: 'required'
                            }
                        }
                    }]
                )
            },
            {
                id:2,
                location: {
                    name:"Site2"        
                },
                experiments:new ExperimentCollection([])
            },
            {
                id:3,
                location: {
                    name:"Site3"        
                },
                experiments:new ExperimentCollection([])
            }]
        );

        // Save each site into the persistence.
        Sites.each(function(site) {
            site.save();
        });

    </script>

    <!-- Main entry point -->
    <script src="app/main.js"></script>
</head>

<body></body>

</html>